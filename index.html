<!DOCTYPE html>
<html>
<head>
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="./howler.js"></script>
    <script src="./underscore-min.js"></script>
    <script src="http://js.leapmotion.com/leap-0.6.4.js"></script>
    <script src="http://js.leapmotion.com/leap-plugins-0.1.10.js"></script>
    <script src="./setupSpeech.js"></script>
    <script src="./dj_listeners.js"></script>
    <link rel="stylesheet" type="text/css" src="./style.css">
    <link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
</head>
<body>

<div class="container">
    <div class="songInfo">
        <span>Current Song</span>
        <span class="position"></span>
    </div>
    <div class="volume">
        <!-- TODO: jQuery slider  -->
    </div>
    <div class="cd">
        <img src="./cd.png" height="300" width="300">
    </div>
    <div class="trackListing">
        <ul>
            <li>Q.U.E.E.N - Janell√© Monae</li>
            <li>Titanium - David Guetta + Sia</li>
            <li>Young And Beautiful - Lana Del Ray</li>
            <li>Bad Kids - The Black Lips</li>
            <li>Stay - Rihanna</li>
        </ul>
    </div>
</div>


<script type="text/javascript">

 // TODO: decide a good tuning parameter for debounced versions
var debouncedCircleListener = _.debounce(circleListener, 1000),
    debouncedSwipeListener = _.debounce(swipeListener, 1000),
    debouncedProcessSpeech = _.debounce(processSpeech, 500),
    sound = new Howl({ urls: ['finalProject/sounds/queen.mp3']}),
    song = "queen";

// SPEECH
var recognition = new webkitSpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;
recognition.onresult = function (event) {
    var transcript = '',
        hasFinal = false;

    for (var i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          hasFinal = true;
        } else
          transcript += event.results[i][0].transcript;
        }

    var processed = debouncedProcessSpeech(transcript, sound);

    if (processed) {
        recognition.stop();
    }
}

recognition.onend = function(event) {
  setTimeout(function() { recognition.start(); }, 1000);
};
recognition.start();

var controller = Leap.loop({enableGestures: true}, function(frame){
  if(frame.valid && frame.gestures.length > 0){
    frame.gestures.forEach(function(gesture){
        switch (gesture.type){
          case "circle":
            console.log("Circle Gesture");
            debouncedCircleListener(gesture);
            break;
          case "swipe":
            console.log("Swipe Gesture");
            debouncedSwipeListener(gesture);
            break;
        }
    });
  }
});

</script>
</body>
</html>